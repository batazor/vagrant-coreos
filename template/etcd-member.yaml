
coreos:
  units:
    - name: etcd-member.service
      command: start
      content: |
        [Service]
        Environment="ETCD_IMAGE_TAG=v3.2.7"
        Environment="ETCD_USER=etcd"
        Environment='ETCD_DATA_DIR=/var/lib/etcd'
        Type=notify
        Restart=always
        RestartSec=5s
        LimitNOFILE=40000
        TimeoutStartSec=0
        ExecStart=/usr/lib/coreos/etcd-wrapper --name=%{ETCD_NODE_NAME} $ETCD_OPTS \
          --advertise-client-urls http://$public_ipv4:2379,http://$public_ipv4:4001 \
          --initial-advertise-peer-urls http://$public_ipv4:2380 \
          --listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 \
          --listen-peer-urls http://0.0.0.0:2380 \
          --initial-cluster %{ETCD_INITIAL_CLUSTER}
        [Install]
        WantedBy=multi-user.target
